<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>IV Machine</title>
<script type="text/javascript">

/* parameters that should be changed */

var drug_name = "Morphine";
var drug_amount = 10;
var drug_rate = 20;
var drug_time = 30;

var item_id_to_give = 42;
var message_success = "You did it!";

/* end of parameters */

var ARIS = {};

var entered_amount = "";
var entered_rate = "";
var entered_time = "";
var editing = null;
var previous_value = "";

function now_editing(thing) {
  editing = thing;
  redisplay();
  switch (editing) {
    case 'amount': previous_value = entered_amount; break;
    case 'rate'  : previous_value = entered_rate  ; break;
    case 'time'  : previous_value = entered_time  ; break;
  }

  passed = true;
  passed = passed && drug_amount == parseFloat(entered_amount);
  passed = passed && drug_rate   == parseFloat(entered_rate  );
  passed = passed && drug_time   == parseFloat(entered_time  );
  if (passed) {
    ARIS.givePlayerItemCount(item_id_to_give, 1);
    alert(message_success);
    ARIS.exit();
  }
}

function redisplay() {
  document.getElementById('display-amount').innerHTML =
    (editing == 'amount' ? entered_amount + '&#9632;' :
    entered_amount == '' ? '???' :
    entered_amount
    ) + ' ml' ;
  document.getElementById('display-rate').innerHTML =
    (editing == 'rate' ? entered_rate + '&#9632;' :
    entered_rate == '' ? '???' :
    entered_rate
    ) + ' ml/hr' ;
  document.getElementById('display-time').innerHTML =
    (editing == 'time' ? entered_time + '&#9632;' :
    entered_time == '' ? '???' :
    entered_time
    ) + ' hrs' ;
}

function type(str) {
  return function() {
    switch (editing) {
      case 'amount': entered_amount += str; break;
      case 'rate'  : entered_rate   += str; break;
      case 'time'  : entered_time   += str; break;
    }
    redisplay();
  }
};

function appReady() {
  document.getElementById('display-drug').innerHTML = drug_name;
  document.getElementById('button-amount').onclick = function(){
    now_editing('amount');
  };
  document.getElementById('button-rate').onclick = function(){
    now_editing('rate');
  };
  document.getElementById('button-time').onclick = function(){
    now_editing('time');
  };
  document.getElementById('button-0').onclick = type('0');
  document.getElementById('button-1').onclick = type('1');
  document.getElementById('button-2').onclick = type('2');
  document.getElementById('button-3').onclick = type('3');
  document.getElementById('button-4').onclick = type('4');
  document.getElementById('button-5').onclick = type('5');
  document.getElementById('button-6').onclick = type('6');
  document.getElementById('button-7').onclick = type('7');
  document.getElementById('button-8').onclick = type('8');
  document.getElementById('button-9').onclick = type('9');
  document.getElementById('button-dot').onclick = type('.');
  document.getElementById('button-clear').onclick = function(){
    switch (editing) {
      case 'amount': entered_amount = ''; break;
      case 'rate'  : entered_rate   = ''; break;
      case 'time'  : entered_time   = ''; break;
    }
    redisplay();
  };
  document.getElementById('button-up').onclick = function(){
    switch (editing) {
      case 'amount':                        break;
      case 'rate'  : now_editing('amount'); break;
      case 'time'  : now_editing('rate'  ); break;
    }
  };
  document.getElementById('button-down').onclick = function(){
    switch (editing) {
      case 'amount': now_editing('rate'); break;
      case 'rate'  : now_editing('time'); break;
      case 'time'  :                      break;
    }
  };
  document.getElementById('button-enter').onclick = function(){
    now_editing(null);
  };
  document.getElementById('button-cancel').onclick = function(){
    switch (editing) {
      case 'amount': entered_amount = previous_value; break;
      case 'rate'  : entered_rate   = previous_value; break;
      case 'time'  : entered_time   = previous_value; break;
    }
    now_editing(null);
  };
}

// hack to wait for both aris and the dom
var locks = 2;
function unlock() {
  locks--;
  if (locks == 0) appReady();
}
ARIS.ready = unlock;
document.addEventListener('DOMContentLoaded', unlock);

</script>
<style type="text/css">

td button {
  width: 6em;
  height: 2em;
}

.display {
  background-color: #0ff;
  font-family: monospace;
  height: 2em;
  font-weight: bold;
}

body {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

</style>
</head>
<body>

<table>
  <tr>
    <td></td>
    <td id="display-drug" class="display" colspan="4">
      ???
    </td>
  </tr>
  <tr>
    <td><button id="button-amount" type="button">&gt;</button></td>
    <td id="display-amount" class="display" colspan="4">
      ??? ml
    </td>
  </tr>
  <tr>
    <td><button id="button-rate" type="button">&gt;</button></td>
    <td id="display-rate" class="display" colspan="4">
      ??? ml/hr
    </td>
  </tr>
  <tr>
    <td><button id="button-time" type="button">&gt;</button></td>
    <td id="display-time" class="display" colspan="4">
      ??? hrs
    </td>
  </tr>
  <tr>
    <td></td>
    <td><button id="button-1" type="button">1</button></td>
    <td><button id="button-2" type="button">2</button></td>
    <td><button id="button-3" type="button">3</button></td>
    <td><button id="button-up" type="button">^</button></td>
  </tr>
  <tr>
    <td></td>
    <td><button id="button-4" type="button">4</button></td>
    <td><button id="button-5" type="button">5</button></td>
    <td><button id="button-6" type="button">6</button></td>
    <td><button id="button-down" type="button">v</button></td>
  </tr>
  <tr>
    <td></td>
    <td><button id="button-7" type="button">7</button></td>
    <td><button id="button-8" type="button">8</button></td>
    <td><button id="button-9" type="button">9</button></td>
    <td><button id="button-enter" type="button">ENTER</button></td>
  </tr>
  <tr>
    <td></td>
    <td><button id="button-clear" type="button">CLEAR</button></td>
    <td><button id="button-0" type="button">0</button></td>
    <td><button id="button-dot" type="button">.</button></td>
    <td><button id="button-cancel" type="button">CANCEL</button></td>
  </tr>
</table>

</body>
</html>
