<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>IV Machine</title>
<script type="text/javascript">

/* parameters that should be changed */

var drug_name = "Morphine";
var drug_amount = 10;
var drug_how_often = 20;
var drug_how_long = 30;

var item_id_to_give = 42;
var message_success = "You did it!";
var message_failure = "Try again.";

/* end of parameters */

var ARIS = {};

var game_screen = 'main';
var entered_amount = 0;
var entered_how_often = 0;
var entered_how_long = 0;
var current_value = '';

function float_equal(a, b) {
  return Math.abs(a - b) < 0.0001;
}

function gameDraw() {
  switch (game_screen) {
    case 'main':
      document.getElementById('display-1').innerHTML = drug_name;
      document.getElementById('display-2').innerHTML =
        ( entered_amount
        + ' mg every '
        + entered_how_often
        + ' mins, for '
        + entered_how_long
        + ' hrs'
        );
      document.getElementById('display-3').innerHTML = '';
      document.getElementById('display-4').innerHTML = '';
      break;
    case 'editing':
      document.getElementById('display-1').innerHTML = 'Edit mode';
      document.getElementById('display-2').innerHTML = 'Amount: ' + entered_amount + ' mg';
      document.getElementById('display-3').innerHTML = 'How often: ' + entered_how_often + ' mins';
      document.getElementById('display-4').innerHTML = 'How long: ' + entered_how_long + ' hrs';
      break;
    case 'editing_amount':
      document.getElementById('display-1').innerHTML = 'Editing amount';
      document.getElementById('display-2').innerHTML = current_value + '&#9632; mg';
      document.getElementById('display-3').innerHTML = '';
      document.getElementById('display-4').innerHTML = '';
      break;
    case 'editing_how_often':
      document.getElementById('display-1').innerHTML = 'Editing how often';
      document.getElementById('display-2').innerHTML = current_value + '&#9632; mins';
      document.getElementById('display-3').innerHTML = '';
      document.getElementById('display-4').innerHTML = '';
      break;
    case 'editing_how_long':
      document.getElementById('display-1').innerHTML = 'Editing how long';
      document.getElementById('display-2').innerHTML = current_value + '&#9632; hrs';
      document.getElementById('display-3').innerHTML = '';
      document.getElementById('display-4').innerHTML = '';
      break;
  }
}

function check() {
  passed = true;
  passed = passed && float_equal(drug_amount   , entered_amount   );
  passed = passed && float_equal(drug_how_often, entered_how_often);
  passed = passed && float_equal(drug_how_long , entered_how_long );
  if (passed) {
    ARIS.givePlayerItemCount(item_id_to_give, 1);
    alert(message_success);
    ARIS.exit();
  } else {
    alert(message_failure);
  }
}

function type(str) {
  return function(){
    current_value += str;
    gameDraw();
  };
}

function appReady() {
  gameDraw();
  document.getElementById('button-line-2').onclick = function(){
    switch (game_screen) {
      case 'main':
        game_screen = 'editing';
        gameDraw();
        break;
      case 'editing':
        game_screen = 'editing_amount';
        current_value = '';
        gameDraw();
        break;
      case 'editing_amount':
        break;
      case 'editing_how_often':
        break;
      case 'editing_how_long':
        break;
    }
  };
  document.getElementById('button-line-3').onclick = function(){
    switch (game_screen) {
      case 'main':
        break;
      case 'editing':
        game_screen = 'editing_how_often';
        current_value = '';
        gameDraw();
        break;
      case 'editing_amount':
        break;
      case 'editing_how_often':
        break;
      case 'editing_how_long':
        break;
    }
  };
  document.getElementById('button-line-4').onclick = function(){
    switch (game_screen) {
      case 'main':
        break;
      case 'editing':
        game_screen = 'editing_how_long';
        current_value = '';
        gameDraw();
        break;
      case 'editing_amount':
        break;
      case 'editing_how_often':
        break;
      case 'editing_how_long':
        break;
    }
  };
  document.getElementById('button-0').onclick = type('0');
  document.getElementById('button-1').onclick = type('1');
  document.getElementById('button-2').onclick = type('2');
  document.getElementById('button-3').onclick = type('3');
  document.getElementById('button-4').onclick = type('4');
  document.getElementById('button-5').onclick = type('5');
  document.getElementById('button-6').onclick = type('6');
  document.getElementById('button-7').onclick = type('7');
  document.getElementById('button-8').onclick = type('8');
  document.getElementById('button-9').onclick = type('9');
  document.getElementById('button-dot').onclick = type('.');
  document.getElementById('button-enter').onclick = function(){
    switch (game_screen) {
      case 'main':
        break;
      case 'editing':
        game_screen = 'main';
        gameDraw();
        check();
        break;
      case 'editing_amount':
        entered_amount = parseFloat(current_value);
        game_screen = 'editing';
        gameDraw();
        break;
      case 'editing_how_often':
        entered_how_often = parseFloat(current_value);
        game_screen = 'editing';
        gameDraw();
        break;
      case 'editing_how_long':
        entered_how_long = parseFloat(current_value);
        game_screen = 'editing';
        gameDraw();
        break;
    }
  }
  document.getElementById('button-clear').onclick = function(){
    current_value = '';
    gameDraw();
  };
  document.getElementById('button-cancel').onclick = function(){
    switch (game_screen) {
      case 'main':
        break;
      case 'editing':
        // could go back to main without editing, but not useful
        break;
      case 'editing_amount':
        game_screen = 'editing';
        gameDraw();
        break;
      case 'editing_how_often':
        game_screen = 'editing';
        gameDraw();
        break;
      case 'editing_how_long':
        game_screen = 'editing';
        gameDraw();
        break;
    }
  }
}

// hack to wait for both aris and the dom
var locks = 2;
function unlock() {
  locks--;
  if (locks == 0) appReady();
}
ARIS.ready = unlock;
document.addEventListener('DOMContentLoaded', unlock);

// for debugging
// ARIS.ready();

</script>
<style type="text/css">

td button {
  width: 6em;
  height: 2em;
}

.display {
  background-color: #0ff;
  font-family: monospace;
  height: 2em;
  font-weight: bold;
}

body {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

</style>
</head>
<body>

<table>
  <tr>
    <td><button id="button-line-1" type="button">&gt;</button></td>
    <td id="display-1" class="display" colspan="4">
    </td>
  </tr>
  <tr>
    <td><button id="button-line-2" type="button">&gt;</button></td>
    <td id="display-2" class="display" colspan="4">
    </td>
  </tr>
  <tr>
    <td><button id="button-line-3" type="button">&gt;</button></td>
    <td id="display-3" class="display" colspan="4">
    </td>
  </tr>
  <tr>
    <td><button id="button-line-4" type="button">&gt;</button></td>
    <td id="display-4" class="display" colspan="4">
    </td>
  </tr>
  <tr>
    <td></td>
    <td><button id="button-1" type="button">1</button></td>
    <td><button id="button-2" type="button">2</button></td>
    <td><button id="button-3" type="button">3</button></td>
    <td><button id="button-up" type="button">^</button></td>
  </tr>
  <tr>
    <td></td>
    <td><button id="button-4" type="button">4</button></td>
    <td><button id="button-5" type="button">5</button></td>
    <td><button id="button-6" type="button">6</button></td>
    <td><button id="button-down" type="button">v</button></td>
  </tr>
  <tr>
    <td></td>
    <td><button id="button-7" type="button">7</button></td>
    <td><button id="button-8" type="button">8</button></td>
    <td><button id="button-9" type="button">9</button></td>
    <td><button id="button-enter" type="button">ENTER</button></td>
  </tr>
  <tr>
    <td></td>
    <td><button id="button-clear" type="button">CLEAR</button></td>
    <td><button id="button-0" type="button">0</button></td>
    <td><button id="button-dot" type="button">.</button></td>
    <td><button id="button-cancel" type="button">CANCEL</button></td>
  </tr>
</table>

</body>
</html>
